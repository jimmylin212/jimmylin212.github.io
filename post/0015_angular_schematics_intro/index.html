<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>如何使用 Angular Schematics 自動產生程式碼 - Jimmy Lin</title>
  <meta name="description" content="2018 年在台灣的 Angular Conference 聽到 Schematics 這個東西就很想使用看看，不過一直沒有機會，最近我們專案開始有其他人加入，對於要做哪些設定或是要新增哪些檔案不是很清楚，">
  <meta name="author" content="Jimmy Lin"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Jimmy Lin",
    
    "url": "https:\/\/jimmylin212.github.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/jimmylin212.github.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/jimmylin212.github.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/jimmylin212.github.io\/post\/0015_angular_schematics_intro\/",
          "name": "如何使用 angular schematics 自動產生程式碼"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Jimmy Lin"
  },
  "headline": "如何使用 Angular Schematics 自動產生程式碼",
  "description" : "2018 年在台灣的 Angular Conference 聽到 Schematics 這個東西就很想使用看看，不過一直沒有機會，最近我們專案開始有其他人加入，對於要做哪些設定或是要新增哪些檔案不是很清楚，",
  "inLanguage" : "en",
  "wordCount":  3612 ,
  "datePublished" : "2019-07-22T11:20:16",
  "dateModified" : "2019-07-22T11:20:16",
  "image" : "https:\/\/jimmylin212.github.io\/images\/avatar.png",
  "keywords" : [ "Angular, Frontend" ],
  "mainEntityOfPage" : "https:\/\/jimmylin212.github.io\/post\/0015_angular_schematics_intro\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/jimmylin212.github.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/jimmylin212.github.io\/images\/avatar.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="如何使用 Angular Schematics 自動產生程式碼" />
<meta property="og:description" content="2018 年在台灣的 Angular Conference 聽到 Schematics 這個東西就很想使用看看，不過一直沒有機會，最近我們專案開始有其他人加入，對於要做哪些設定或是要新增哪些檔案不是很清楚，">
<meta property="og:image" content="https://jimmylin212.github.io/images/avatar.png" />
<meta property="og:url" content="https://jimmylin212.github.io/post/0015_angular_schematics_intro/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Jimmy Lin" />

  <meta name="twitter:title" content="如何使用 Angular Schematics 自動產生程式碼" />
  <meta name="twitter:description" content="2018 年在台灣的 Angular Conference 聽到 Schematics 這個東西就很想使用看看，不過一直沒有機會，最近我們專案開始有其他人加入，對於要做哪些設定或是要新增哪些檔案不是很清楚，">
  <meta name="twitter:image" content="https://jimmylin212.github.io/images/avatar.png" />
  <meta name="twitter:card" content="summary" />
  <link href='https://jimmylin212.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.69.1" />
  <link rel="alternate" href="https://jimmylin212.github.io/index.xml" type="application/rss+xml" title="Jimmy Lin"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://jimmylin212.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://jimmylin212.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://jimmylin212.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2756751-14', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jimmylin212.github.io">Jimmy Lin</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Jimmy Lin" href="https://jimmylin212.github.io">
            <img class="avatar-img" src="https://jimmylin212.github.io/images/avatar.png" alt="Jimmy Lin" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>如何使用 Angular Schematics 自動產生程式碼</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on July 22, 2019
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;minutes
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Jimmy Lin
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>2018 年在台灣的 Angular Conference 聽到 Schematics 這個東西就很想使用看看，不過一直沒有機會，最近我們專案開始有其他人加入，對於要做哪些設定或是要新增哪些檔案不是很清楚，為了增加團隊的生產力，立刻想到可以用 Schematics 這個懶人工具，可以自動產生程式碼，也可以省去 email 或口頭溝通的時間，網路上找到一篇不錯的教學，這篇文章有點像翻譯，不過加上一些自己的使用情境，希望可以幫到一些懶人工程師。</p>
<p>這篇文章會涵蓋下列的這些主題</p>
<ol>
<li>新增一個 schematics 的 workspace</li>
<li>schematics 概念簡介，包含 Factory, Rule, Tree 等等</li>
<li>建置 schematics</li>
<li>執行 schematics</li>
<li>實作簡單的 schematics</li>
<li>讓 schematics 使用參數</li>
<li>在 schematics 使用 template</li>
<li>整合 schematics 的指令到 angular cli workspace</li>
</ol>
<h2 id="前置作業">前置作業</h2>
<p>在開始之前，先安裝 <code>@angular-devkit/schematics-cli</code> 才可以使用 schematics 指令，建議用 global 安裝，因為這個程式和 Angular 獨立的，我們可以使用 schematics 來產生各種樣板程式碼，減少時間。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># install schematics-cli globally</span>
npm install -g @angular-devkit/schematics-cli
</code></pre></div><h2 id="新增-schematics-的-workspace">新增 schematics 的 workspace</h2>
<p>先新增一個空白的 schematic 吧。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 新增 schematics</span>
schematics blank hello
</code></pre></div><p>新增完之後會看到在我們的專案中有個新的資料夾 <code>hello</code>，裡面有些預設的檔案，來看一下一些比較重要的檔案。第一個是 <code>collection.json</code>，這個檔案主要的 definition 檔，裡面包含了所有定義的 schematics。<code>collection.json</code> 的內容如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="err">//</span> <span class="err">collection.json</span>
<span class="p">{</span>
  <span class="nt">&#34;$schema&#34;</span><span class="p">:</span> <span class="s2">&#34;../node_modules/@angular-devkit/schematics/collection-schema.json&#34;</span><span class="p">,</span>
  <span class="nt">&#34;schematics&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;hello&#34;</span><span class="p">:</span> <span class="p">{</span>  <span class="err">//</span> <span class="err">schematics</span> <span class="err">的名稱</span>
      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A blank schematic.&#34;</span><span class="p">,</span>
      <span class="nt">&#34;factory&#34;</span><span class="p">:</span> <span class="s2">&#34;./hello/index#hello&#34;</span>     <span class="err">//</span> <span class="err">scehmatics</span> <span class="err">要執行的</span> <span class="err">function</span> <span class="err">的路徑以及</span> <span class="err">function</span> <span class="err">名稱</span>
    <span class="p">}</span>                                      <span class="err">//</span> <span class="err">在這邊就是要去執行</span> <span class="err">./hello/index</span> <span class="err">檔內的</span> <span class="err">hello</span> <span class="err">function</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>接下來看一下程式的本體吧，看一下 <code>./hello/index.ts</code> 的內容</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Rule</span><span class="p">,</span> <span class="nx">SchematicContext</span><span class="p">,</span> <span class="nx">Tree</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/schematics&#39;</span><span class="p">;</span>

<span class="c1">// You don&#39;t have to export the function as default. You can also have more than one rule factory
</span><span class="c1">// per file.
</span><span class="c1"></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">_options</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">Rule</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">,</span> <span class="nx">_context</span>: <span class="kt">SchematicContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">tree</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><h2 id="schematics-概念簡介">schematics 概念簡介</h2>
<h3 id="schematic-factory">Schematic Factory</h3>
<p>首先，hello 這個 function 就是一個 factory，這個 factory 回傳一個 Rule。可能有人會質疑為什麼我們需要一個 factory，而不直接實作 rule 就好了。因為我們會在不同的情況下使用 schematics ，所以我們需要視情況做調整。</p>
<h3 id="rule">Rule</h3>
<p>另外一個重要的部分就是 Rule，Rule 被呼叫時需要 <code>tree</code> 以及 <code>SchematicContext</code>。當被呼叫時，Rule 會做 tree 做調整，並且回傳調整後的 tree，以便後續使用。</p>
<h3 id="tree">Tree</h3>
<p>Tree 是一個虛擬的資料夾結構，使用虛擬的資料夾結構有幾個優點</p>
<ol>
<li>只會在 schematic 成功結束後才真的做出改變</li>
<li>可以使用 <code>--dry-run</code> 來預先看一下產出，而不用真的新增/修改檔案</li>
<li>提供更好的效能，因為並不是在流程中對檔案作操作</li>
</ol>
<h2 id="建置-schematics">建置 schematics</h2>
<p>我們的 schematics 用 typescript 撰寫，不過我們是跑在 node 環境下，所以在執行之前要記得編譯所有的 <code>.ts</code> 檔，不然執行是會失敗的。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">npm run build
</code></pre></div><p>因為需要編譯，如果在開發的過程當中每一個小修改都要編譯一次有點麻煩，也可以新增一個新的 command 到 package.json 內，就可以支援 hot-loading 了。</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;build-watch&#34;</span><span class="p">:</span> <span class="s2">&#34;tsc -p tsconfig.json --watch&#34;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="執行-schematics">執行 schematics</h2>
<p>可以直接使用 schematics cli 來執行特定的 schematic，指令格式為 <code>schematics &lt;package-name&gt;:&lt;schematic-name&gt; [...options]</code>。Package name 可以是類似 <code>@schematics/angular</code>，而 schematic name 可以為 <code>component</code>。schematic cli 預設會去 <code>node_modules</code> 裡面找到對應的 package 以及 schematic 執行。不過因為我們的 hello 還不是一個 package，這種情況下我們可以用以下指令執行</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">schematics .:hello
</code></pre></div><p>執行結果如下：</p>

<link rel="stylesheet" href="https://jimmylin212.github.io/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/01.jpg" alt="/images/0015/01.jpg"/>
    </div>
    <a href="/images/0015/01.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>當然也可以在其他層的資料夾透過相對路徑來執行，例如我們現在回到前一層資料夾，再次執行</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/02.jpg" alt="/images/0015/02.jpg"/>
    </div>
    <a href="/images/0015/02.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<h2 id="實作簡單的-schematics">實作簡單的 schematics</h2>
<p>終於到重頭戲了，要開始實作第一個 schematic 了。來小小修改一下 <code>hello</code> schematic，當執行 hello schematic 的時候產生一個 <code>hello.js</code> 的檔案，內容為 <code>console.log('Hello World');</code>，要做到這件事情，可以用 <code>.create()</code>，程式碼如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Rule</span><span class="p">,</span> <span class="nx">SchematicContext</span><span class="p">,</span> <span class="nx">Tree</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/schematics&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">_options</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">Rule</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">,</span> <span class="nx">_context</span>: <span class="kt">SchematicContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">tree</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;hello.js&#39;</span><span class="p">,</span> <span class="sb">`console.log(&#39;Hello World&#39;);`</span><span class="p">);</span>  <span class="c1">// 新增這行
</span><span class="c1"></span>    <span class="k">return</span> <span class="nx">tree</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>再次執行 hello，執行結果如下</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/03.jpg" alt="/images/0015/03.jpg"/>
    </div>
    <a href="/images/0015/03.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>詭異的事情發生了，明明就寫了 CREATE 不過為什麼在資料夾內沒有新增檔案呢？因為當我們使用相對路徑 <code>.</code> 的時候，schematics 會用 debug mode 執行。debug mode 執行的結果和使用 <code>--dry-run</code> 一樣，並不會真的有檔案的 IO，可以使用 <code>--debug=false</code> 或是 <code>--dry-run=false</code> 來關閉，再執行一次就可以看到真的有個 <code>hello.js</code> 被新增出來了，執行結果也如預期印出了 <code>Hello World</code>。</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/04.jpg" alt="/images/0015/04.jpg"/>
    </div>
    <a href="/images/0015/04.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<h2 id="讓-schematics-使用參數">讓 schematics 使用參數</h2>
<p>不過這樣還不算是個有用的 schematic，現在我們加點東西，讓 schematic 讀參數。schematic 的 <code>_options</code> 包含了一起傳進來的 flags，假設我們的指令會是 <code>schematics .:hello --name=Jimmy --debug=false</code>，修改一下 schematic 的程式碼：</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Rule</span><span class="p">,</span> <span class="nx">SchematicContext</span><span class="p">,</span> <span class="nx">Tree</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/schematics&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">_options</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">Rule</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">,</span> <span class="nx">_context</span>: <span class="kt">SchematicContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="kr">const</span> <span class="p">{</span> <span class="nx">name</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">_options</span><span class="p">;</span> <span class="c1">// 從 _options 讀取 name
</span><span class="c1"></span>
    <span class="nx">tree</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;hello.js&#39;</span><span class="p">,</span> <span class="sb">`console.log(&#39;Hello </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">&#39;);`</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">tree</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>上面的做法沒有問題，不過這會把所有的 flags 都傳進來，有些參數可能不是我們需要的，或是格式錯誤，這種情況可以新增 Schema 來描述參數的格式以及做驗證。在 <code>./src/hello</code> 資料夾新增檔案 <code>schema.json</code>，內容如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;$schema&#34;</span><span class="p">:</span> <span class="s2">&#34;http://json-schema.org/schema&#34;</span><span class="p">,</span>
  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;HelloSchematics&#34;</span><span class="p">,</span>
  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Hello Option Schema&#34;</span><span class="p">,</span>
  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;object&#34;</span><span class="p">,</span>
  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Say hello to someone&#34;</span><span class="p">,</span>
  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The name of the person&#34;</span><span class="p">,</span>
      <span class="nt">&#34;$default&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;$source&#34;</span><span class="p">:</span> <span class="s2">&#34;argv&#34;</span><span class="p">,</span>
        <span class="nt">&#34;index&#34;</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;name&#34;</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>檔案中 <code>properties</code> 就是要傳進來的參數，<code>type</code> 可以接受不同種類比方 <code>string</code>、<code>boolean</code> 或是 <code>enum</code>，另外這邊使用了 positional option 的方式，因此不一定要寫 <code>--name</code>，只要是第一個參數，就會被 assign 到 name 上。接下來要讓 <code>collection.json</code> 知道要去哪邊找這個 <code>schema.json</code>，修改 <code>collection.json</code> 內容如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;$schema&#34;</span><span class="p">:</span> <span class="s2">&#34;../node_modules/@angular-devkit/schematics/collection-schema.json&#34;</span><span class="p">,</span>
  <span class="nt">&#34;schematics&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;hello&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A blank schematic.&#34;</span><span class="p">,</span>
      <span class="nt">&#34;factory&#34;</span><span class="p">:</span> <span class="s2">&#34;./hello/index#hello&#34;</span><span class="p">,</span>
      <span class="nt">&#34;schema&#34;</span><span class="p">:</span> <span class="s2">&#34;./hello/schema.json&#34;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>再來可以用 typescript 的 interface 幫我們做類別驗證，新增 <code>schema.d.ts</code>：</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Schema</span> <span class="p">{</span>
  <span class="nx">name</span>: <span class="kt">string</span>
<span class="p">}</span>
</code></pre></div><p>修改 schematic 的 <code>_options</code> 類別為 Schema：</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Rule</span><span class="p">,</span> <span class="nx">SchematicContext</span><span class="p">,</span> <span class="nx">Tree</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/schematics&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Schema</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./schema&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">_options</span>: <span class="kt">Schema</span><span class="p">)</span><span class="o">:</span> <span class="nx">Rule</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">,</span> <span class="nx">_context</span>: <span class="kt">SchematicContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">name</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">_options</span>
    <span class="nx">tree</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;hello.js&#39;</span><span class="p">,</span> <span class="sb">`console.log(&#39;Hello </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">&#39;);`</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">tree</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>甚至新增 prompt 增加 UX，再次修改 <code>schema.json</code>，增加 <code>x-prompt</code> 於 <code>name</code> 下</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;$schema&#34;</span><span class="p">:</span> <span class="s2">&#34;http://json-schema.org/schema&#34;</span><span class="p">,</span>
  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;HelloSchematics&#34;</span><span class="p">,</span>
  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Hello Option Schema&#34;</span><span class="p">,</span>
  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;object&#34;</span><span class="p">,</span>
  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Say hello to someone&#34;</span><span class="p">,</span>
  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The name of the person&#34;</span><span class="p">,</span>
      <span class="nt">&#34;$default&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;$source&#34;</span><span class="p">:</span> <span class="s2">&#34;argv&#34;</span><span class="p">,</span>
        <span class="nt">&#34;index&#34;</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="nt">&#34;x-prompt&#34;</span><span class="p">:</span> <span class="s2">&#34;Who do you want to greet?&#34;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;name&#34;</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>一切都完成之後再次執行 <code>schematics .:hello --debug=false</code></p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/05.jpg" alt="/images/0015/05.jpg"/>
    </div>
    <a href="/images/0015/05.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<h2 id="在-schematics-使用-template">在 schematics 使用 template</h2>
<p>到目前為止都是很基本的使用方法，在真實使用情境下，我們不可能在 schematic 的 function 寫所有的 code，這時候 Angular 提供的 template 就派上用場了。要使用 template，可以新增一個 <code>./files/</code> 資料夾，當然也可以取名其他的，不過可以看一下 <code>tsconfig.ts</code>，可以發現 <code>src/*/files/**/*</code> 已經被 exclude 掉了，所以編譯的時候不會編譯到這些檔案。</p>
<p>首先先增加一個資料夾叫做 <code>hello-__name@dasherize__</code>，乍看之下是個奇怪的名稱，不過其來有自。其中 <code>__</code> 是特定的 delimiter 可以分開 <code>name</code> 變數和其他的部分。<code>dasherizer</code> 是一個 helper function，會收到 name 的值，做特定的轉換，<code>@</code> 是特殊字元讓 name 使用 <code>dasherizer</code> helper function。這整段的意思是說，假設我們的名稱是 <code>AwesomeWrap</code> 會自動幫我轉換成 <code>hello-awesome-wrap</code>。接下來在這個資料夾中再新增一個類似的文件取名叫 <code>hello-__name@dasherize__.ts</code>，內容如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello &lt;%= name %&gt;&#39;</span><span class="p">);</span>
</code></pre></div><p>有點像 Django 的 template 語法，用 <code>&lt;%=</code> 和 <code>%&gt;</code> 把參數夾起來，再 template 裡面也可以寫其他的 helper function，比如說：</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello &lt;%= dasherize(name) %&gt;&#39;</span><span class="p">);</span>

<span class="c1">// or
</span><span class="c1"></span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello &lt;%= classify(name) %&gt;&#39;</span><span class="p">);</span>
</code></pre></div><p>接下來要讓 schematic 的 fuction 和 template 串聯在一起。修改 <code>./hello/index.js</code> 內容如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Rule</span><span class="p">,</span> <span class="nx">SchematicContext</span><span class="p">,</span> <span class="nx">Tree</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">apply</span><span class="p">,</span> <span class="nx">template</span><span class="p">,</span> <span class="nx">mergeWith</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/schematics&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Schema</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./schema&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">strings</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/core&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">_options</span>: <span class="kt">Schema</span><span class="p">)</span><span class="o">:</span> <span class="nx">Rule</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">,</span> <span class="nx">_context</span>: <span class="kt">SchematicContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">sourceTemplate</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;./files&#39;</span><span class="p">);</span> <span class="c1">// 取得 template 檔案
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">sourceParameterizedTemplates</span> <span class="o">=</span> <span class="nx">apply</span><span class="p">(</span><span class="nx">sourceTemplate</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">template</span><span class="p">({</span>
        <span class="p">...</span><span class="nx">_options</span><span class="p">,</span>
        <span class="p">...</span><span class="nx">strings</span><span class="p">,</span>
      <span class="p">})</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">mergeWith</span><span class="p">(</span><span class="nx">sourceParameterizedTemplates</span><span class="p">);</span> <span class="c1">// merge the template into tree
</span><span class="c1"></span>  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>接下來在執行一次指令 <code>schematic .:hello 'jimmy lin' --debug=false</code></p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/06.jpg" alt="/images/0015/06.jpg"/>
    </div>
    <a href="/images/0015/06.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>可以看到新的資料夾 <code>hello-jimmy-lin</code> 以及新的檔案 <code>hello-jimmy-lin.ts</code>，執行過後也丟出正確的歡迎訊息。</p>
<p>這個歡迎的訊息只是簡單的教學，實際上使用可能有很多情境，像是</p>
<ul>
<li>針對不同的 endpoint 產生類似的 service 檔案</li>
<li>針對不同的 module 給同樣的 dependencies</li>
<li>&hellip;</li>
</ul>
<p>因為是 template 語言，所以常見的 if-else 或是 for-loop 也都有支援，詳細可以看一下他們的文件。未來如果有機會再補上。</p>
<h2 id="整合-schematics-的指令到-angular-cli-workspace">整合 schematics 的指令到 angular cli workspace</h2>
<p>目前都只是在 hello 這個 schematic 資料夾中操作，要懶就要懶到底，如果還要把產生的檔案手動複製到特定資料夾，那真得太麻煩了，來看一下怎麼整合 Angular CLI 吧。Angular CLI 通常都包含零到多個專案 <em>(project)</em>，每一次當我們執行 <code>ng generate component</code> 時，都是在某個專案中執行。<code>angular.json</code> 中有指明了 <code>defaultProject</code> 是哪一個，當然下指令時也可以用 <code>--project some-app</code> 來指定要跑在哪個專案下。要整合在一起就首先修改 <code>scehma.json</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">...</span>
  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;project&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Generate in specific Angular CLI workspace project&#34;</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="err">...</span>
<span class="p">}</span>
</code></pre></div><p>以及 <code>schema.d.ts</code></p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Schema</span> <span class="p">{</span>
  <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">project?</span>: <span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>接下來要修改一下 <code>./hello/index.ts</code>，看起來有點多不過簡單來說就是在找正確的路徑以及複製到正確的路徑下。</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Rule</span><span class="p">,</span> <span class="nx">SchematicContext</span><span class="p">,</span> <span class="nx">Tree</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">apply</span><span class="p">,</span> <span class="nx">template</span><span class="p">,</span> <span class="nx">mergeWith</span><span class="p">,</span> <span class="nx">SchematicsException</span><span class="p">,</span> <span class="nx">move</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/schematics&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Schema</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./schema&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">strings</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular-devkit/core&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">parseName</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@schematics/angular/utility/parse-name&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">buildDefaultPath</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@schematics/angular/utility/project&#39;</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">_options</span>: <span class="kt">Schema</span><span class="p">)</span><span class="o">:</span> <span class="nx">Rule</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">,</span> <span class="nx">_context</span>: <span class="kt">SchematicContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">workspaceConfigBuffer</span> <span class="o">=</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;angular.json&#39;</span><span class="p">);</span> <span class="c1">// 看看執行的地方有沒有 angular.json 來確定是不是在 angular workspace 下
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">workspaceConfigBuffer</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">SchematicsException</span><span class="p">(</span><span class="s1">&#39;Not Angular CLI workspace&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">const</span> <span class="nx">workspaceConfig</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">workspaceConfigBuffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>   <span class="c1">// 讀取 config
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">projectName</span> <span class="o">=</span> <span class="nx">_options</span><span class="p">.</span><span class="nx">project</span> <span class="o">||</span> <span class="nx">workspaceConfig</span><span class="p">.</span><span class="nx">defaultProject</span><span class="p">;</span> <span class="c1">// --project 或是 default project
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">project</span> <span class="o">=</span> <span class="nx">workspaceConfig</span><span class="p">.</span><span class="nx">projects</span><span class="p">[</span><span class="nx">projectName</span><span class="p">];</span>                  <span class="c1">// 取得 project definition
</span><span class="c1"></span>
    <span class="c1">// buildDefaultPath(project)  取得預設的 project 路徑
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">defaultProjectPath</span> <span class="o">=</span> <span class="nx">buildDefaultPath</span><span class="p">(</span><span class="nx">project</span><span class="p">);</span>

    <span class="c1">// _options.name 可能包含路徑，比如說 some-feature/some-sub-feature/some-service
</span><span class="c1"></span>    <span class="c1">// 利用 parseName 拆成 some-feature/some-sub-feature 以及 some-service
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">parsedPath</span> <span class="o">=</span> <span class="nx">parseName</span><span class="p">(</span><span class="nx">defaultProjectPath</span><span class="p">,</span> <span class="nx">_options</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

    <span class="kr">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">path</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">parsedPath</span><span class="p">;</span>

    <span class="kr">const</span> <span class="nx">sourceTemplate</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;./files&#39;</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">sourceParameterizedTemplates</span> <span class="o">=</span> <span class="nx">apply</span><span class="p">(</span><span class="nx">sourceTemplate</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">template</span><span class="p">({</span>
        <span class="p">...</span><span class="nx">_options</span><span class="p">,</span>
        <span class="p">...</span><span class="nx">strings</span><span class="p">,</span>
        <span class="nx">name</span><span class="p">,</span> <span class="c1">// 覆寫 _options.name
</span><span class="c1"></span>      <span class="p">}),</span>
      <span class="nx">move</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>  <span class="c1">// 複製到正確的路徑
</span><span class="c1"></span>    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">mergeWith</span><span class="p">(</span><span class="nx">sourceParameterizedTemplates</span><span class="p">)(</span><span class="nx">tree</span><span class="p">,</span> <span class="nx">_context</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>上面都設定好之後，就可以嘗試在 Angular workspace 執行看看</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/07.jpg" alt="/images/0015/07.jpg"/>
    </div>
    <a href="/images/0015/07.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>可以看到新增了檔案在 <code>./src/feature/hello-jimmy-lin</code> 下。更酷的是已經直接幫我們把 help message 都寫好了:</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/08.jpg" alt="/images/0015/08.jpg"/>
    </div>
    <a href="/images/0015/08.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>我覺得每次都要下 <code>./hello/src/collection.json</code> 實在有點難記，有一招可以把他跟 schematics 指令整合在一起，首先安裝<code>@schematics/angular</code>，再來使用 <code>npm link</code></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">npm link ./hello
</code></pre></div><p>之後就可以直接使用 <code>ng generate hello:hello</code> 執行。</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/0015/09.jpg" alt="/images/0015/09.jpg"/>
    </div>
    <a href="/images/0015/09.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>以上就是第一階段的 Angular Schematics 教學，其實發現蠻多專案都會使用到，像是 Angular 本身就是使用 Schematics 產生 component 那些相依的檔案，另外 Angular Material 也會用 Schematics 來產生一些特定檔案，文件在<a href="https://material.angular.io/guide/schematics">這邊</a>，比如說 drag-and-drop 可能有一些基本設定要設，Angular Material 就都先寫好了。</p>
<p>本文主要是參考<a href="https://medium.com/@tomastrajan/total-guide-to-custom-angular-schematics-5c50cf90cdb4">這篇文章</a>的，如有問題也可留言討論。
另外原碼在這邊：https://github.com/jimmylin212/ex-angular-schematics 也歡迎參考</p>


        
          <div class="blog-tags">
            
              <a href="https://jimmylin212.github.io/tags/angular/">Angular</a>&nbsp;
            
              <a href="https://jimmylin212.github.io/tags/frontend/">Frontend</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fjimmylin212.github.io%2fpost%2f0015_angular_schematics_intro%2f&amp;text=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20Angular%20Schematics%20%e8%87%aa%e5%8b%95%e7%94%a2%e7%94%9f%e7%a8%8b%e5%bc%8f%e7%a2%bc&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjimmylin212.github.io%2fpost%2f0015_angular_schematics_intro%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fjimmylin212.github.io%2fpost%2f0015_angular_schematics_intro%2f&amp;title=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20Angular%20Schematics%20%e8%87%aa%e5%8b%95%e7%94%a2%e7%94%9f%e7%a8%8b%e5%bc%8f%e7%a2%bc" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fjimmylin212.github.io%2fpost%2f0015_angular_schematics_intro%2f&amp;title=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20Angular%20Schematics%20%e8%87%aa%e5%8b%95%e7%94%a2%e7%94%9f%e7%a8%8b%e5%bc%8f%e7%a2%bc" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fjimmylin212.github.io%2fpost%2f0015_angular_schematics_intro%2f&amp;title=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20Angular%20Schematics%20%e8%87%aa%e5%8b%95%e7%94%a2%e7%94%9f%e7%a8%8b%e5%bc%8f%e7%a2%bc" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fjimmylin212.github.io%2fpost%2f0015_angular_schematics_intro%2f&amp;description=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20Angular%20Schematics%20%e8%87%aa%e5%8b%95%e7%94%a2%e7%94%9f%e7%a8%8b%e5%bc%8f%e7%a2%bc" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://jimmylin212.github.io/post/0014_password_confirm_using_angular/" data-toggle="tooltip" data-placement="top" title="在 Angular 中用 Directive 實作密碼確認表單">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://jimmylin212.github.io/post/0016_firebase_and_angular_auth_with_role/" data-toggle="tooltip" data-placement="top" title="Angular &#43; Firebase 以角色為基礎的權限管理">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
          
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jimmylin212-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
          
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:jimmylin212@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/jimmylin212" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/jimmylin212" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/jimmylin212" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://stackoverflow.com/users/743158/jimmy-lin" title="StackOverflow">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="jimmylin212.github.io">Jimmy Lin</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2020
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://jimmylin212.github.io">Jimmy Lin</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.69.1</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://jimmylin212.github.io/js/main.js"></script>
<script src="https://jimmylin212.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://jimmylin212.github.io/js/load-photoswipe.js"></script>









    
  </body>
</html>

